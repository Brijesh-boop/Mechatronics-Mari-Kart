import serial
import time

#Arduino's serial port
port = '/dev/ttyACM0'

try:
    arduino = serial.Serial(port, 115200, timeout=1)
    print(f"Connected to {port}")
    time.sleep(2)  # wait for Arduino to reset
except:
    print(f"Failed t  o connect to {port}")
    exit()

def send_command(cmd, speed):
    # Build the command string like {MOT-CWO|50}
    message = "{" + cmd + "|" + str(speed) + "}"
    arduino.write(message.encode())
    print("Sent: " + message)
    
    # Wait for Arduino response
    time.sleep(0.1)
    while arduino.in_waiting > 0:
        response = arduino.readline().decode().strip()
        if response:
            print("Arduino says: " + response)

# Test the motor commands
print("Testing motor control")

print("\n- Clockwise test ")
send_command("MOT-CWO", 75)
time.sleep(3)

print("\n- Stop test ")
send_command("MOT-STOP", 0)
time.sleep(1)

print("\n- Counter-clockwise test")
send_command("MOT-CCW", 50)
time.sleep(3)

print("\n- Ramp speed test ")
for speed in [30, 60, 90, 60, 30]:
    send_command("MOT-CWO", speed)
    time.sleep(1)

print("\n- Final stop ")
send_command("MOT-STOP", 0)

arduino.close()
print("Done")
